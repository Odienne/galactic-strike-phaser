var e=Object.defineProperty,o=(o,t,s)=>((o,t,s)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s)(o,"symbol"!=typeof t?t+"":t,s);import{r as t}from"./phaser-y5S3hZEA.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&o(e)})).observe(document,{childList:!0,subtree:!0})}function o(e){if(e.ep)return;e.ep=!0;const o=function(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?o.credentials="include":"anonymous"===e.crossOrigin?o.credentials="omit":o.credentials="same-origin",o}(e);fetch(e.href,o)}}();var s=t();class n extends s.Scene{constructor(){super("Boot")}preload(){}create(){this.scene.start("Game")}}class a{constructor(e){this.scene=e,this.laser1=this.scene.add.video(125,265,"laser1").setOrigin(0,0).setDepth(-400).setVisible(!1).play(!0),this.laser2=this.scene.add.video(125,265,"laser2").setOrigin(0,0).setDepth(-400).setVisible(!1).play(!0),this.laser3=this.scene.add.video(125,265,"laser3").setOrigin(0,0).setDepth(-400).setVisible(!1).play(!0),this.laser1.once("play",(()=>{this.laser1.setDisplaySize(870,510)})),this.laser2.once("play",(()=>{this.laser2.setDisplaySize(870,510).stop()})),this.laser3.once("play",(()=>{this.laser3.setDisplaySize(870,510).stop()})),this.playVideo()}playVideo(){switch(void 0!==this.currentVideo&&(this.currentVideo.setDepth(-500),this.currentVideo.stop()),window.currentWeapon){case 1:default:this.currentVideo=this.laser1;break;case 2:this.currentVideo=this.laser2;break;case 3:this.currentVideo=this.laser3}try{this.currentVideo.setVisible(!0),this.currentVideo.setDepth(-400),this.currentVideo.play(!0)}catch(e){console.warn("Video play failed:",e)}}}class i{constructor(){o(this,"onMessage",(async e=>{var o;const t=JSON.parse(e);if("request"===t.type&&(null==(o=t.payload)?void 0:o.func)){console.log("request"),console.log(t.payload.func);let e=null;switch(t.payload.func){case"isWeaponOffCoolDown":e=await this.isWeaponOffCoolDown();break;case"updateWeaponCooldown":e=await this.updateWeaponCooldown();break;case"transitionToGameOver":e=await this.transitionToGameOver()}this.socket.send(JSON.stringify({type:"response",from:this.clientId,to:t.from,payload:{result:e},requestId:t.requestId}))}})),o(this,"isWeaponOffCoolDown",(()=>{const e=window.getWeaponInfos();return console.log(e[window.currentWeapon].cooldown<=0),e[window.currentWeapon].cooldown<=0})),o(this,"updateWeaponCooldown",(()=>{console.log("updating cooldown"),window.updateWeaponCooldown(window.currentWeapon)})),this.socket=new WebSocket("ws://localhost:3000"),this.clientId="Weapon Screen",this.pendingRequests=[],this.socket.onopen=e=>this.onOpen(e),this.socket.onclose=e=>this.onClose(e),this.socket.onmessage=e=>this.onMessage(e.data)}onOpen(){console.log("Connection ok"),this.socket.send(JSON.stringify({type:"register",from:this.clientId}))}onClose(){console.log("Connection lost")}setWeapon(e){window.setWeapon(e);const o=crypto.randomUUID();this.socket.send(JSON.stringify({type:"request",from:this.clientId,to:"Game Screen",payload:{func:"setWeapon",weaponId:e},requestId:o}))}transitionToGameOver(){window.transitionToGameOver()}}class r extends Phaser.Scene{constructor(){super("Game"),window.moveWeaponLeft=()=>{window.currentWeapon>1?this.socket.setWeapon(window.currentWeapon-1):this.socket.setWeapon(3),this.changeWeaponAudio.play(),this.setVideo(),this.setBackgroundImage(),this.setWeaponTitle(),3===window.currentWeapon&&window.getWeapon(3).cooldown<=0&&this.supernovaAudio.play()},window.moveWeaponRight=()=>{window.currentWeapon<3?this.socket.setWeapon(window.currentWeapon+1):this.socket.setWeapon(1),this.changeWeaponAudio.play(),this.setVideo(),this.setBackgroundImage(),this.setWeaponTitle(),3===window.currentWeapon&&window.getWeapon(3).cooldown<=0&&this.supernovaAudio.play()},window.transitionToGameOver=()=>this.transitionToGameOver()}preload(){this.load.image("bg1","assets/bg1.png"),this.load.image("bg2","assets/bg2.png"),this.load.image("bg3","assets/bg3.png"),this.load.video("laser1","assets/videos/laser1.webm",!0),this.load.video("laser2","assets/videos/laser2.webm",!0),this.load.video("laser3","assets/videos/laser3.webm",!0),this.load.video("laser3","assets/videos/laser3.webm",!0),this.load.audio("change-weapon","assets/sfx/01-change-weapon.mp3"),this.load.audio("supernova","assets/sfx/02-supernova.mp3"),this.loadFonts()}create(){this.socket=new i(this),this.changeWeaponAudio=this.sound.add("change-weapon"),this.supernovaAudio=this.sound.add("supernova"),this.weaponsData=window.getWeaponInfos(),this.weaponVideoManager=new a(this),this.initCooldownDisplay(),this.setBackgroundImage(),this.title=this.add.text(980,60,this.weaponsData[window.currentWeapon].name,{align:"center",fontFamily:"HemiHead",fontSize:"60px",color:"#ffffff",padding:10}).setOrigin(.5,.5).setDepth(1e3),this.setWeaponTitle(),this.setupInput()}update(e,o){Object.keys(this.cooldownRects).forEach((e=>{const o=this.cooldownRects[e],t=o.weaponId,s=window.getWeapon(t),n=Date.now()-s.lastUsed,a=Phaser.Math.Clamp(n/s.cooldown,0,1);s.baseCooldown<n?o.text.isBlinking||(o.text.isBlinking=!0,this.tweens.add({targets:o.text,alpha:{from:1,to:.6},color:{from:16711680,to:16777215},yoyo:!0,duration:200,ease:"Sine.easeInOut",onComplete:()=>{o.text.setAlpha(1)}}),this.tweens.add({targets:o.text,scale:2,yoyo:!0,duration:100,onComplete:()=>{o.text.setScale(1)}}),window.resetWeaponCooldown(t)):(o.text.isBlinking=!1,this.tweens.killTweensOf(o.text),o.text.setAlpha(.2).setScale(.92)),o.rect.width=o.fullWidth*a,window.currentWeapon===parseInt(e)?this.cooldownRects[e].bgRect.setAlpha(.6):this.cooldownRects[e].bgRect.setAlpha(0)}))}setupInput(){["ONE","TWO","THREE"].forEach(((e,o)=>{this.input.keyboard.on(`keydown-${e}`,(()=>{o+1!==window.currentWeapon&&(this.changeWeaponAudio.play(),this.socket.setWeapon(o+1),this.setVideo(),this.setBackgroundImage(),this.setWeaponTitle(),o+1===3&&window.getWeapon(3).cooldown<=0&&this.supernovaAudio.play())}))})),this.input.keyboard.on("keydown-SPACE",(()=>{window.isWeaponOffCoolDown(window.currentWeapon)&&window.updateWeaponCooldown(window.currentWeapon)}))}loadFonts(){this.loadFont("HemiHead","assets/fonts/HemiHead/hemihead.otf")}loadFont(e,o){new FontFace(e,`url(${o})`).load().then((function(e){document.fonts.add(e)})).catch((function(e){return e}))}preloadAudio(){}setBackgroundImage(){switch(window.currentWeapon){case 1:default:this.add.image(0,0,"bg1").setOrigin(0,0).setDisplaySize(1920,1080).setDepth(100);break;case 2:this.add.image(0,0,"bg2").setOrigin(0,0).setDisplaySize(1920,1080).setDepth(100);break;case 3:this.add.image(0,0,"bg3").setOrigin(0,0).setDisplaySize(1920,1080).setDepth(100)}}setWeaponTitle(){this.title.text=this.weaponsData[window.currentWeapon].name}setVideo(){this.weaponVideoManager.playVideo()}initCooldownDisplay(){this.cooldownRects={};const e=window.getWeaponInfos(),o=640;Object.keys(e).forEach(((t,s)=>{const n=e[t],a=o*(t-1),i=this.add.rectangle(a,952,o,128,n.fillColor).setAlpha(.1).setDepth(890).setOrigin(0,0),r=this.add.rectangle(a,1067.2,o,12.8,n.fillColor).setAlpha(1).setDepth(900).setOrigin(0,0);this.cooldownRects[t]={rect:r,bgRect:i,fullWidth:o,cooldown:n.cooldown,weaponId:t};const d=a+320;this.cooldownRects[t].text=this.add.text(d,1013,n.name,{align:"center",fontFamily:"HemiHead",fontSize:"38px",color:"#ffffff",padding:10}).setOrigin(.5,.5).setDepth(1e3)}))}transitionToGameOver(){const e=this.cameras.main.postFX.addPixelate(-1);this.add.tween({targets:e,duration:700,amount:40,onComplete:()=>{this.cameras.main.fadeOut(100),this.scene.start("GameOver")}})}}class d extends s.Scene{constructor(){super("GameOver")}create(){this.cameras.main.setBackgroundColor(0)}}class l extends s.Scene{constructor(){super("Preloader")}init(){this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(o=>{e.width=4+460*o}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png")}create(){this.scene.start("MainMenu")}}const c={type:Phaser.WEBGL,width:1920,height:1080,parent:"game-container",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1920,height:1080},scene:[n,l,r,d],fps:{target:30,forceSetTimeOut:!0},disableVisibilityChange:!0,render:{antialias:!0,roundPixels:!1,maxTextures:20,batchSize:4096,clearBeforeRender:!0,failIfMajorPerformanceCaveat:!1,transparent:!1}};document.addEventListener("DOMContentLoaded",(()=>{new s.Game({...c,parent:"game-container"})}));let p={1:{name:"LASER V1",fillColor:"0xff0000",cooldown:0,baseCooldown:800,lastUsed:null},2:{name:"PLASMA V3",fillColor:"0xe66eff",cooldown:0,baseCooldown:1e4,lastUsed:null},3:{name:"SUPERNOVA V9",fillColor:"0xff9300",cooldown:0,baseCooldown:3e4,lastUsed:null}};function h(e){window.sendToQt(JSON.stringify({weaponOffCooldown:e}))}window.currentWeapon=1,window.updateWeaponCooldown=e=>{switch(parseInt(e)){case 1:p[1].cooldown=p[1].baseCooldown,p[1].lastUsed=Date.now();break;case 2:p[2].cooldown=p[2].baseCooldown,p[2].lastUsed=Date.now();break;case 3:p[3].cooldown=p[3].baseCooldown,p[3].lastUsed=Date.now()}},window.resetWeaponCooldown=e=>{switch(parseInt(e)){case 1:p[1].cooldown=0;break;case 2:p[2].cooldown=0;break;case 3:p[3].cooldown=0}parseInt(e)===window.currentWeapon&&h(!0)},window.setWeapon=e=>{window.currentWeapon=e,window.sendToQt(JSON.stringify({weaponId:e})),h(window.isWeaponOffCoolDown(e))},window.isWeaponOffCoolDown=e=>p[e].cooldown<=0,window.getWeaponInfos=()=>p,window.getWeapon=e=>p[e],window.setLanguage=e=>(console.log(e),e);
